schema: moran
source_dir: ../dist
script: |
  function eq(left, right)
    print('Left  = ' .. tostring(left))
    print('Right = ' .. tostring(right))
    return left == right
  end

deploy:
  default:
    tests:
      - send: l
        assert: eq(cand[1].text, 'äº†') and eq(cand[1].comment, "âš¡ï¸")
      - send: le
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "âš¡ï¸")
      - send: lem
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "âš¡ï¸")
      - send: lemd
        assert: eq(cand[1].text, "æ¥½") and eq(cand[1].comment, "")
      - send: hello
        assert: eq(cand[1].text, "hello")
      - send: jis
        assert: eq(cand[1].text, "ç´š") and eq(cand[1].comment, "âš¡ï¸")
      - send: jisjo
        assert: eq(cand[1].text, "ç´€")
      - send: ubbs
        assert: eq(cand[1].text, "ç˜¦")
      - send: dmbd
        assert: eq(cand[1].text, "ç™²")
      - send: vidt
        assert: eq(cand[1].text, "æ²»")
      - send: lnyl
        assert: eq(cand[1].text, "éœ–")
      - send: hodd
        assert: eq(cand[1].text, "ç«")
      - send: N2000
        assert: eq(cand[1].text, "2000å¹´01æœˆ01æ—¥")
      - send: U8888
        assert: eq(cand[1].text, 'è¢ˆ')
      - send: S114514
        assert: eq(cand[1].text, 'åä¸€è¬å››åƒäº”ç™¾ä¸€åå››')
      - send: olfuvuv
        assert: eq(cand[1].text, 'å†°') and eq(cand[1].comment, 'by[du] ny[du]')

  opencc:
    options:
      simplification: true
    tests:
      - send: ai
        assert: eq(cand[1].text, "çˆ±")

  emoji:
    options:
      emoji: true
    tests:
      - send: hk
        assert: eq(cand[2].text, "ğŸ‘Œ")
      - send: o
        assert: eq(cand[2].text, "ğŸ˜¯")
      - send: ou
        assert: eq(cand[2].text, "â‚¬")
      - send: mzgo
        assert: eq(cand[2].text, "ğŸ‡ºğŸ‡¸")
      - send: vsgo
        assert: eq(cand[2].text, "ğŸ‡¨ğŸ‡³")
      - send: y
        assert: eq(cand[2].text, "1ï¸âƒ£")
      - send: 'e;'
        assert: eq(commit, 'å…’')
      - send: 'y;'
        assert: eq(commit, "åˆ")
      - send: 'sd;'
        assert: eq(commit, "3D")

  quick_code_indicator_empty:
    patch:
      moran/quick_code_indicator: ""
    tests:
      - send: l
        assert: eq(cand[1].text, "äº†") and eq(cand[1].comment, "")
  quick_code_indicator_other:
    patch:
      moran/quick_code_indicator: "ğŸ’¥"
    tests:
      - send: l
        assert: eq(cand[1].text, "äº†") and eq(cand[1].comment, "ğŸ’¥")
      - send: le
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "ğŸ’¥")
      - send: lem
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "ğŸ’¥")
      - send: lemd
        assert: eq(cand[1].text, "æ¥½") and eq(cand[1].comment, "")

  word_filter:
    patch:
      moran/enable_word_filter: true
    tests:
      - send: lmjx
        assert: eq(cand[1].text, "éˆæ¥") and eq(cand[1].comment, "")
      - send: lmjxz
        assert: eq(cand[1].text, "é€£æ¥") and eq(cand[1].comment, "zf")
  word_filter_match_indicator:
    patch:
      moran/enable_word_filter: true
      moran/word_filter_match_indicator: "ğŸ¯"
    tests:
      - send: lmjx
        assert: eq(cand[1].text, "éˆæ¥") and eq(cand[1].comment, "")
      - send: lmjxz
        assert: eq(cand[1].text, "é€£æ¥") and eq(cand[1].comment, "ğŸ¯")

  word_ijrq:
    patch:
      moran/ijrq/enable_word: true
    tests:
      - send: lmjxf
        assert: eq(cand[1].text, "é€£æ¥") and eq(cand[2].text, "éˆæ¥")
      - send: "yiry "
        assert: eq(commit, "å„„")
      - send: yiry/
        assert: eq(cand[1].text, "å„„")
  word_ijrq_defer:
    patch:
      moran/ijrq/enable_word: true
      moran/ijrq/enable_word_defer: 2
    tests:
      - send: lmjxf
        assert: eq(cand[1].text, "é€£æ¥") and eq(cand[2].text, "è¯æ¥") and eq(cand[3].text, "éˆæ¥")

  pin:
    options:
      emoji: false
    tests:
      - send: 'lmjx'
        assert: eq(cand[1].text, 'éˆæ¥') and eq(cand[2].text, 'é€£æ¥')
      - send: 'lmjx{Control+t}'
        assert: eq(cand[1].comment, "ğŸ“Œ") and eq(preedit, "lm jx")
      - send: 'lmjx{Control+t}'
        assert: eq(cand[1].comment, "") and eq(preedit, "lm jx")
      - send: 'lmjx{Down}{Control+t}'
        assert: eq(cand[1].text, 'é€£æ¥') and eq(cand[1].comment, "ğŸ“Œ")
      - send: 'lmjx'
        assert: eq(cand[1].text, 'é€£æ¥') and eq(cand[1].comment, "ğŸ“Œ")
      - send: 'xad//xnraidg 2 xad'
        assert: eq(cand[1].text, 'ä¿¡æ„›ç­‰')
      - send: 'a{Control+t}{Down}{Control+t}{Control+equal}'
        assert: eq(cand[1].text, 'å•Š') and eq(cand[2].text, 'æ„›') and eq(cand[1].comment, "ğŸ“Œ") and eq(cand[2].comment, "ğŸ“Œ")
      - send: 'ai{Control+t}{Down}{Control+t}{Down}{Control+minus}'
        assert: eq(cand[1].text, 'æ„›') and eq(cand[2].text, 'å”‰') and eq(cand[1].comment, "ğŸ“Œ") and eq(cand[2].comment, "ğŸ“Œ")

  force_segmentation:
    tests:
      # input_len = 5
      - send: 'dafju'
        assert: eq(preedit, "da fju")
      - send: 'dafju{Control+l}'
        assert: eq(preedit, "daf'ju")
      - send: 'dafju{Control+l}{Control+l}'
        assert: eq(preedit, "da'fju")
      # input_len = 6
      - send: 'dajwhk'
        assert: eq(preedit, 'da jw hk')
      - send: 'dajwhk{Control+l}'
        assert: eq(preedit, "daj'whk")
      - send: 'dajwhk{Control+l}{Control+l}'
        assert: eq(preedit, "da'jw'hk")
      # input_len = 7
      - send: 'dajwhkn'
        assert: eq(preedit, 'da jw hkn')
      - send: 'dajwhkn{Control+l}'
        assert: eq(preedit, "da'jwh'kn")
      - send: 'dajwhkn{Control+l}{Control+l}'
        assert: eq(preedit, "daj'wh'kn")
      - send: 'dajwhkn{Control+l}{Control+l}{Control+l}'
        assert: eq(preedit, "da'jw'hkn")
      # å–®å­—
      - send: 'mumho{Control+l}'
        assert: eq(preedit, "mu'mho")
      # å››ç¢¼
      - send: 'jism{Control+l}'
        assert: eq(preedit, "ji'sm")
      - send: 'jism{Control+l}{Control+l}'
        assert: eq(preedit, 'jism')

  steal_auxcode:
    tests:
      - send: 'mzfadsl2'
        assert: eq(cand[1].text, 'å¡')
      - send: 'mzfadsl2{Control+l}'
        assert: eq(cand[1].text, 'å‹•')
      - send: 'mzfadsl2{Control+l}{Control+l}'
        assert: eq(cand[1].text, 'å¡')
      - send: 'ljflkr'
        assert: eq(cand[1].text, 'æ””æ¬¾')
      - send: 'ljflkr2'
        assert: eq(cand[1].text, 'å¯¬')
      - send: 'ljflkr2{Control+l}'
        assert: eq(cand[1].text, 'ä½¬')
      - send: 'ljflkr2{Control+l}{Control+l}'
        assert: eq(cand[1].text, 'å¯¬')

  inject_chars:
    patch:
      moran/inject_fixed_chars: true
    tests:
      - send: 'wuyw'
        assert: eq(cand[1].text, 'éœ§') and eq(cand[2].text, 'èª£') and eq(cand[3].text, 'çˆ²æ™‚å·²æ™š')

  inject_words_first:
    patch:
      moran/inject_fixed_words: true
      moran/inject_fixed_chars: true
      moran/inject_prioritize: 'word'
    tests:
      - send: 'wuyw'
        assert: eq(cand[1].text, 'éœ§') and eq(cand[2].text, 'çˆ²æ™‚å·²æ™š') and eq(cand[3].text, 'èª£')

  inject_chars_first:
    patch:
      moran/inject_fixed_words: true
      moran/inject_fixed_chars: true
      moran/inject_prioritize: 'char'
    tests:
      - send: 'wuyw'
        assert: eq(cand[1].text, 'éœ§') and eq(cand[2].text, 'èª£') and eq(cand[5].text, 'çˆ²æ™‚å·²æ™š')

  english:
    tests:
      - send: 'monkey'
        assert: eq(cand[1].text, 'monkey')
      - send: 'Monke'
        assert: eq(cand[1].text, 'Monkey')
      - send: 'iphone'
        assert: eq(cand[1].text, 'iPhone')
      - send: 'iPho'
        assert: eq(cand[1].text, 'iPhone')
      - send: 'IPh'
        assert: "#cand == 0"
      - send: 'nihkHello '
        assert: eq(cand[1].text, 'Hello')
      - send: 'U75'
        assert: eq(cand[1].text, 'u')
      - send: 'ArchL'
        assert: eq(cand[1].text, 'Arch Linux')

# yaml-language-server: $schema=https://raw.githubusercontent.com/rimeinn/mira/refs/heads/master/spec/mira.schema.json
